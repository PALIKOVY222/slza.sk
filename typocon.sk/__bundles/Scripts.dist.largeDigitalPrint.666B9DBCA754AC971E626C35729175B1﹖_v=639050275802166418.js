(()=>{"use strict";class n{constructor(n,t,i,r){this.id=r;this.name=n;this.width=t;this.height=i}}class nt{constructor(n){this.Formats=[];this.initFormatsByKey(n)}initFormatsByKey(t){this.Formats=[];"UnboundedSheet"==t||"Sticker"==t||"SpecialMaterial"==t?(this.Formats.push(new n("MaxSDP",308,440,13)),this.Formats.push(new n("A3",297,420,22)),this.Formats.push(new n("A4",210,297,23)),this.Formats.push(new n("A5",148,210,24)),this.Formats.push(new n("A6",105,148,25)),this.Formats.push(new n("A7",74,105,26)),this.Formats.push(new n("F420x100",420,100,28)),this.Formats.push(new n("F90x50",90,50,29)),this.Formats.push(new n("F85x55",85,55,30)),this.Formats.push(new n("DL",210,100,27))):"LargeDigitalPrint"==t?(this.Formats.push(new n("MaxLDP",2030,3200,14)),this.Formats.push(new n("A0",841,1189,19)),this.Formats.push(new n("A1",594,841,20)),this.Formats.push(new n("A2",420,594,21)),this.Formats.push(new n("A3",297,420,22)),this.Formats.push(new n("A4",210,297,23)),this.Formats.push(new n("B0",1e3,1414,15)),this.Formats.push(new n("B1",707,1e3,16)),this.Formats.push(new n("B2",500,707,17)),this.Formats.push(new n("B3",353,500,18)),this.Formats.push(new n("Custom",210,100,31)),this.Formats.push(new n("E800x2000",800,2e3,35)),this.Formats.push(new n("E850x2000",850,2e3,36)),this.Formats.push(new n("E1000x2000",1e3,2e3,37)),this.Formats.push(new n("E1200x2000",1200,2e3,38)),this.Formats.push(new n("E1500x2000",1500,2e3,39)),this.Formats.push(new n("E2000x2000",2e3,2e3,40)),this.Formats.push(new n("D850x2000",850,2e3,41)),this.Formats.push(new n("D1000x2000",1e3,2e3,42)),this.Formats.push(new n("OB100x100",100,100,44)),this.Formats.push(new n("OB100x150",100,150,45)),this.Formats.push(new n("OB200x200",200,200,46)),this.Formats.push(new n("OB200x300",200,300,47)),this.Formats.push(new n("OB300x400",300,400,48)),this.Formats.push(new n("OB500x700",500,700,49)),this.Formats.push(new n("OB700x1000",700,1e3,50)),this.Formats.push(new n("OB3000x3000",3e3,3e3,51)),this.Formats.push(new n("OB1900x2900",1900,2900,52)),this.Formats.push(new n("OB2000x3000",2e3,3e3,53)),this.Formats.push(new n("OB1000x2000",1e3,2e3,54))):"BoundedSheet"==t&&(this.Formats.push(new n("A6P",105,148,9)),this.Formats.push(new n("A6L",148,105,10)),this.Formats.push(new n("A5P",148,210,7)),this.Formats.push(new n("A5L",210,148,8)),this.Formats.push(new n("A4P",210,297,5)),this.Formats.push(new n("A4L",297,210,6)),this.Formats.push(new n("A3P",297,420,3)),this.Formats.push(new n("A3L",420,297,4)),this.Formats.push(new n("MaxP",308,440,1)),this.Formats.push(new n("MaxL",440,308,2)),this.Formats.push(new n("DLP",100,210,27)),this.Formats.push(new n("DLL",210,100,27)),this.Formats.push(new n("DLL",210,100,27)),this.Formats.push(new n("C150x200",150,200,55)),this.Formats.push(new n("C300x125",300,125,56)),this.Formats.push(new n("C150x420",150,420,57)),this.Formats.push(new n("C210x297",210,297,58)),this.Formats.push(new n("C240x420",240,420,59)),this.Formats.push(new n("C280x420",280,420,60)),this.Formats.push(new n("C297x420",297,420,61)),this.Formats.push(new n("C308x220",308,220,62)),this.Formats.push(new n("C380x520",380,260,63)),this.Formats.push(new n("C198x148",198,148,64)))}getFormatByValue(n){for(var t=0,i=this.Formats.length;t<i;t++)if(this.Formats[t].name==n)return this.Formats[t]}getFormatById(n){for(var t=0,i=this.Formats.length;t<i;t++)if(this.Formats[t].id==n)return this.Formats[t]}}class tt{constructor(){this.reset()}reset(){this.defaultProductId=0;this.productTemplateId="";this.sku="";this.isDefault=!1;this.templateKey="NoProduct";this.name="";this.sortKey=null;this.orderId=null;this.comments="";this.extraWork="";this.itemCount=0;this.formatKey="31";this.width=0;this.height=0;this.pageCount=0;this.sheetCountOrAreaM2=0;this.materialKey="NoMaterial";this.grammageOrThickness=0;this.chromaFrontEnum=1;this.chromaBackEnum=1;this.whiteFrontEnum=1;this.whiteBackEnum=1;this.lackerMatteFrontEnum=1;this.lackerMatteBackEnum=1;this.lackerGlossFrontEnum=1;this.lackerGlossBackEnum=1;this.uvRedFrontEnum=1;this.uvRedBackEnum=1;this.laminoFrontEnum=1;this.laminoBackEnum=1;this.whiteLdpEnum=1;this.lackerLdpEnum=1;this.encapsulationOrBleed=!1;this.dieCut=!1;this.kissCut=!1;this.edgeReinforcement=!1;this.tunnel=!1;this.eyelets=!1;this.canvasEdge=1;this.screws=1;this.roundedCorners=!1;this.pesonalizationEnum=1;this.foldKey="NoFold";this.coldStampFrontEnum="NoStamp";this.coldStampBackEnum="NoStamp";this.coverPageCount=0;this.coverSheetCountOrAreaM2=0;this.coverMaterialKey="NoMaterial";this.coverGrammageOrThickness=-1;this.coverChromaFrontEnum=1;this.coverChromaBackEnum=1;this.coverLaminoFrontEnum=1;this.coverLaminoBackEnum=1;this.coverEncapsulation=!1;this.noBindOrDuplex=!1;this.bindingKey="NoBind";this.bindingComments=null;this.unibindBackKey="NoBack";this.unibindBackColorEnum=1;this.coilSpiralKey="NoSpiral";this.coilSpiralColorEnum=1;this.coilFoilKey="NoFoil";this.coilFoilColorEnum=1;this.coilCartonKey="";this.coilCartonColorEnum=1;this.frameEnum=1;this.stateEnum=1;this.chromaFrontConst=1;this.chromaFrontCoef=1;this.chromaBackConst=1;this.chromaBackCoef=1;this.discountChromaPC=0;this.discountMinSheetsorM2=1e3;this.isNew=!1;this.promoText="";this.taxPc=23;this.priceBase=0;this.price=0;this.priceExtra=0;this.isPriceDraft=!1;this.isMaterialTypeDiscount=!1;this.hasFixedPrice=!1;this.isWhite=!1;this.discount=0;this.productNote="";this.optionId=null;this.printDataType=0;this.printDataLink="";this.printDataInfo=""}}class i{static start(){""==window.location.hash?i.navigate("orders"):$(window).trigger("hashchange")}static changeRoute(n){abp.event.trigger("changeRoute",n)}static navigate(n,t){var i=null!=t?this.createUrlParameters(t):"";window.location.hash="#"+n+i}static createUrlParameters(n){var t="";return Object.keys(n).forEach(function(i,r){0==r?t="?":r>=1&&(t+="&");t+=i+"="+n[i]}),t}static getProductRouteName(n){var t="";switch(n){case"UnboundedSheet":case"Sticker":case"SpecialMaterial":t="SmallDigitalPrint";break;case"BoundedSheet":t="BoundedSheet";break;case"RollMaterial":case"SheetMaterial":case"PlateMaterial":t="LargeDigitalPrint";break;case"AdvertisingSystem":case"WallSticker":t="AdvertisingSystem";break;default:t="GeneralProduct"}return t}static isAdmin(){return""!=window.location.hash}}class it{onStart(){}onLeave(){}onEnter(){}onDestroy(){}setTitle(){}}class rt extends it{constructor(n,t){super();this.min=1;this.max=1e5;this.minDimensions=[1,1];this.maxDimensions=[1e5,1e5];this.stepDimension=1;this.calculatePriceDelay=400;this.loadFilesFromFolderCallback=()=>{var n;this.loadFilesFromFolder();"function"==typeof smartsupp&&(null===(n=top.document.getElementById("smartsupp-widget-container"))||void 0===n||n.style.setProperty("display","block","important"))};this.pageSelector=null!=t?t:"body";this.ActualFormats=new nt(n);this.Product=new tt}onStart(){console.log("init file upload");this.initFileUpload();this.initUserEdit();this.initOrderDetail();this.setTitle();this.changeHeightOfBackstage()}onEnter(){$(this.pageSelector+" .selectpicker").selectpicker();LayoutCheckboxVisibilityToggle.init();this.initFormEvents()}onDestroy(){$(this.pageSelector+" .selectpicker").selectpicker("destroy");$(this.pageSelector+" .c-toggle-hide").off("change");$(".update-product").off("click");$(this.pageSelector+" .calculate").off("change");$(this.pageSelector+" #add-to-basket").off("click");$(this.pageSelector+" #add-to-order").off("click");console.log("fileupload destroy");$(this.pageSelector+" .fileupload").off("fileuploaddestroy");$(this.pageSelector+" .fileupload").fileupload("destroy");$(this.pageSelector+" #EditUserButton").off("click");$(this.pageSelector+" #OrderDetailButton").off("click");$(this.pageSelector).off("click",".create-zip");$(this.pageSelector+" .remove-coupon").off("click");$("body").off("click",".link-open-design");window.removeEventListener("StudioFinished",this.loadFilesFromFolderCallback,!1);this.Product.reset()}onLeave(){}changeHeightOfBackstage(){var n=$(this.pageSelector+" .right-side").outerHeight();this.P$(".backstage-top").css("min-height",n+"px")}copyToClipboard(n){var t=document.createElement("textarea");document.body.appendChild(t);t.value=n;t.select();document.execCommand("copy");document.body.removeChild(t)}initFormEvents(){$(this.pageSelector+" .update-product").one("click",n=>{var t=$(n.currentTarget).attr("data-next");this.updateProduct(t);$(this.pageSelector+" .update-product").hide()});$(this.pageSelector+" .price-draft-button").on("click",()=>{$(this.pageSelector+" .c-price-draft-info-over-price").hide(),$(this.pageSelector+" .price-draft-button").hide(),$(this.pageSelector+" .c-price-draft-after-agreed").show()});$(this.pageSelector+" textarea").one("change",()=>{$(this.pageSelector+" .update-product").show()});null!=$("#admin-select-order").attr("data-id")?$(this.pageSelector+" .add-to-order[number=0]").show():$(this.pageSelector+" .add-to-order[number=0]").hide();$(this.pageSelector+" .add-to-order").one("click",n=>{var t=Number($(n.currentTarget).attr("number"));this.addToOrder(n,t)});$(this.pageSelector+" .calculate").on("change",n=>{this.checkInputBeforeCalculatePrice($(n.currentTarget))&&(clearTimeout(this.calculatePriceTimer),this.calculatePriceTimer=setTimeout(()=>{this.calculatePrice()},this.calculatePriceDelay))});$(this.pageSelector+" #product-template").on("changed.bs.select",n=>{var t=$(n.currentTarget).val(),r=i.getProductRouteName(this.Product.parentKey);i.navigate(r,{productName:t})});$(this.pageSelector+" .remove-coupon").on("click",n=>{var t=$(n.currentTarget).parent().attr("data-id");console.log("removing coupon",t);abp.services.app.product.removeCouponFromProduct(t).then(()=>{$(n.currentTarget).parent().hide(),$(this.pageSelector+" input[name=itemCount]").prop("readonly",!1),this.calculatePrice(),this.updateProduct(!1)})});$(this.pageSelector).on("click",".create-zip",n=>{n.preventDefault();var t=$(this.pageSelector+" .fileupload").find("input[name=directory]").val();abp.services.app.file.createZip(t).then(()=>{abp.notify.success("zip created");var i=t.split(/[/]+/).pop(),r=window.location.origin+"/Uploads/LocalUser/"+t+"/"+i+".zip",n=document.createElement("a");document.body.appendChild(n);$(n).attr("href",r).attr("download",i);n.click();$(n).unbind();$(n).remove();this.loadFilesFromFolder()})});$(this.pageSelector+" #edit-product-name").on("click",n=>{n.preventDefault(),$(this.pageSelector+" #edit-product-name").hide(),$(this.pageSelector+" .product-name").hide(),$(this.pageSelector+" .new-product-name").css("display","initial")});$(this.pageSelector+" select[name=printDataType]").on("change",n=>{var t=$(n.currentTarget).selectpicker("val");$(this.pageSelector+" .haveData-tab").hide();$(this.pageSelector+" .useGraphic-tab").hide();$(this.pageSelector+" .studio-tab").hide();0==t?$(this.pageSelector+" .haveData-tab").show():1==t?$(this.pageSelector+" .useGraphic-tab").show():2==t&&$(this.pageSelector+" .studio-tab").show()});$(this.pageSelector).on("click",".template-download.json a",n=>{n.preventDefault();var t=$(n.currentTarget).attr("title"),i=(new URL($(n.currentTarget).attr("href")),{directory:"/Uploads/LocalUser/"+$(this.pageSelector+" .fileupload").find("input[name=directory]").val()+"/",templateName:this.Product.productTemplateId,templateId:t});abp.auth.isGranted("Admin.Products.Edit")||null!=abp.currentUser.impersonatorUserId?swal.fire({title:"Vytvoriť PDF?",html:'<a class="link-open-design" href="'+t+'">'+t+"<\/a>",icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"PDF",confirmButtonColor:"#52c9ba",denyButtonText:"Editor",denyButtonColor:"#ff4081",cancelButtonText:"Zrušiť"}).then(n=>{n.isConfirmed?abp.services.app.pdf.generatePdf(i).then(()=>{this.loadFilesFromFolder(),swal.fire({icon:"success",title:"PDF vytvorené",toast:!0,position:"bottom-start",showConfirmButton:!1,timer:3e3})}):n.isDenied&&this.createStudio(i)}):abp.message.confirm(t,"Prajete si editovať váš dizajn?").then(n=>{n.isConfirmed&&this.createStudio(i)})});$("body").on("click",".link-open-design",n=>{n.preventDefault();swal.close();var t=$(n.currentTarget).attr("href");new app.ModalManager({viewUrl:abp.appPath+"admin/designs/createoreditmodal",scriptUrl:abp.appPath+"Scripts/app/Designs/_CreateOrEditModal.js",modalClass:"CreateOrEditDesignModal"}).open({id:t})});window.addEventListener("StudioFinished",this.loadFilesFromFolderCallback,!1)}calculatePrice(){$(this.pageSelector+" .update-product").show();this.updateProductData();abp.services.app.price.calculatePrice(this.Product).then(n=>{this.afterCalculatePriceHandler(n),window.location.toString().toLowerCase().indexOf("admin")})}updateProduct(n,t){this.updateProductData();var i=$(this.pageSelector+" #product-formular").attr("data-cart");abp.ui.setBusy(this.pageSelector+" .update-product");abp.services.app.product.updateProduct(this.Product,n,i).then(i=>{this.afterUpdateProductHandler(n,i,t),abp.ui.clearBusy(this.pageSelector+" .update-product")})}addToOrder(n,t=0){var r=null;if(0==t){if(null==(r=$("#admin-select-order").attr("data-id")))return void abp.message.warn("Najprv vyberte objednávku");this.Product.orderId=Number(r)}this.updateProductData();var u=$(this.pageSelector+" #product-formular").attr("data-cart"),f=$(this.pageSelector+" #product-formular").attr("redirect-url"),e=$(this.pageSelector+" #sessionId").val();abp.ui.setBusy(n.currentTarget,abp.services.app.product.updateProduct(this.Product,!1,u,e,t).then(n=>{""==window.location.hash?-2==t?location.href=location.href+"/"+n.id:(Cookies.set("cart-added",n.id,{expires:new Date((new Date).getTime()+3e5)}),location.href=f):(t<0&&abp.services.app.order.getProductCount().then(function(n){var t=null==abp.currentUser.impersonatorUserId?"green":"dark";n.count>0?$("#admin-cart").attr("data-after-content",n.count).addClass("badge-top").addClass(t):$("#admin-cart").attr("data-after-content",0).removeClass("badge-top").addClass(t);n.wishlistCount>0?$("#admin-wishlist").attr("data-after-content",n.wishlistCount).addClass("badge-top purple"):$("#admin-wishlist").attr("data-after-content",0).removeClass("badge-top purple")}),-2==t?i.navigate("wishlist"):-1==t?i.navigate("orderDetail",{}):i.navigate("orderDetail",{id:r}))}))}updateProductData(){var n=$(this.pageSelector+" select[name=materialKey] option:selected").is(":disabled"),t=$(this.pageSelector+" select[name=coverMaterialKey] option:selected").is(":disabled");n&&($(this.pageSelector+" select[name=materialKey] option:selected").prop("disabled",!1),$(this.pageSelector+" select[name=materialKey]").selectpicker("refresh"));t&&($(this.pageSelector+" select[name=coverMaterialKey] option:selected").prop("disabled",!1),$(this.pageSelector+" select[name=coverMaterialKey]").selectpicker("refresh"));$.extend(this.Product,$(this.pageSelector+" #product-formular").serializeFormToObject());this.Product.printDataType=Number($(this.pageSelector+' select[name="printDataType"]').selectpicker("val"));this.Product.printDataLink=$(this.pageSelector+' input[name="printDataLink"]').val();this.Product.printDataInfo=$(this.pageSelector+' textarea[name="printDataInfo"]').val();this.Product.comments=$(this.pageSelector+' textarea[name="comments"]').val();this.Product.extraWork=$(this.pageSelector+' textarea[name="extraWork"]').val();this.Product.productNote=$(this.pageSelector+' textarea[name="productNote"]').val();n&&($(this.pageSelector+" select[name=materialKey] option:selected").prop("disabled",!0),$(this.pageSelector+" select[name=materialKey]").selectpicker("refresh"));t&&($(this.pageSelector+" select[name=coverMaterialKey] option:selected").prop("disabled",!0),$(this.pageSelector+" select[name=coverMaterialKey]").selectpicker("refresh"));abp.auth.isGranted("Admin.Products.Edit")||null!=abp.currentUser.impersonatorUserId?(this.Product.priceExtra=$(this.pageSelector+" input[name=priceExtra]").val(),this.Product.taxPc=$(this.pageSelector+" select[name=taxPc]").val()):(console.log("default tax",Number(abp.setting.get("TaxPc"))),this.Product.taxPc=Number(abp.setting.get("TaxPc")));this.Product.priceExtra=this.Product.priceExtra?this.Product.priceExtra:0}afterUpdateProductHandler(n,t){abp.event.trigger("product-changed",t);abp.notify.success("Produkt aktualizovaný");var r=$(this.pageSelector+" #OrderDetailButton").attr("data-order-id"),u=Number($(this.pageSelector+" #OrderDetailButton").attr("data-order-number")),f=window.location.toString().indexOf("admin")>-1;console.log("navigate: ",u,r,this.Product.stateEnum);f?-2==u?i.navigate("wishlist"):-1==u?i.navigate("orderDetail",{}):null!=r?Number(this.Product.stateEnum)<3?i.navigate("orderDetail",{id:r}):window.history.back():$(window).trigger("hashchange"):window.location.reload()}updateGrammage(n=!1){var u=n?"coverGrammageOrThickness":"grammageOrThickness",f=n?"coverEncapsulation":"encapsulationOrBleed",i=Number(abp.setting.get("EncapsulationMaxGrammage")),r=Number($(this.pageSelector+" select[name="+u+"]").selectpicker("val")),t=$(this.pageSelector+" input[name="+f+"]")[0];r<=i&&null!=t&&($(t).removeAttr("disabled"),$(this.pageSelector+" .encapsulation-max-gramage").hide());null!=t&&r>i&&($(this.pageSelector+" .encapsulation-max-gramage").html("Pri enkapsulácii je maximálna možná gramáž papiera "+i+"g."),$(t).attr("disabled",""),$(t).prop("checked",!1),$(this.pageSelector+" .encapsulation-max-gramage").show())}initItemCountBounderies(){this.min=Number($(this.pageSelector+" input[name=itemCount]").attr("min"));this.max=Number($(this.pageSelector+" input[name=itemCount]").attr("max"))}initDimensionRestrictions(){this.minDimensions=JSON.parse($(this.pageSelector+" input[name=minDimensions]").val());this.maxDimensions=JSON.parse($(this.pageSelector+" input[name=maxDimensions]").val());this.stepDimension=JSON.parse($(this.pageSelector+" input[name=stepDimension]").val());console.log("DIM: ",this.minDimensions,this.maxDimensions,this.stepDimension)}initFileUpload(){var n=$(this.pageSelector+" .fileupload"),t=$(this.pageSelector+" .files");0!=n.length&&((n=n.fileupload({disableImageResize:!0,autoUpload:!0,maxFileSize:104857600,filesContainer:t,messages:{maxFileSize:"File exceeds maximum allowed size of 100MB"},acceptFileTypes:/(\.|\/)(gif|jpe?g|png|pdf|doc|docx|xls|xlsx|csv|zip|rar|cdr|psd|tif|tiff|7z|indd|qxd|ai|eps|dxf)$/i})).fileupload("option","redirect",window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s")),n.on("fileuploaddestroy",function(n,t){$.ajax({data:JSON.stringify({path:t.url}),dataType:"json",contentType:"application/json",type:"POST",url:abp.appPath+"api/file/deletefile"}).then(function(){t.context[0].remove()})}),this.loadFilesFromFolder())}loadFilesFromFolder(){console.log("called studio event");var n=$(this.pageSelector+" .fileupload");$(this.pageSelector+" tbody.files").empty();n.addClass("fileupload-processing");$.ajax({url:n.attr("action"),type:"POST",contentType:"application/x-www-form-urlencoded",cache:!1,processData:!1,data:n.serialize()}).always(()=>{n.removeClass("fileupload-processing")}).done(t=>{console.log("files",t),n.fileupload("option","done").call(n,$.Event("done"),{result:t})})}initUserEdit(){$(this.pageSelector+" #EditUserButton").on("click",n=>{n.preventDefault();var t=$(n.currentTarget).attr("data-user-id");i.navigate("profile",{id:t})})}initOrderDetail(){$(this.pageSelector+" #OrderDetailButton").on("click",n=>{var t,r;n.preventDefault();t=Number($(n.currentTarget).attr("data-order-number"));-2==t?i.navigate("wishlist"):-1==t?i.navigate("orderDetail",{}):(r=$(n.currentTarget).attr("data-order-id"),i.navigate("orderDetail",{id:r}))})}P$(n){return $(this.pageSelector+" "+n)}canShowDraftPrice(){var n=$(this.pageSelector+" input[name=orderState]").val();return!("True"!=$(this.pageSelector+" input[name=canShowDraftprice]").val()||n>2)}setTitle(){if("True"!=this.Product.isDefault){var n=$(this.pageSelector+" input[name=orderNumber]").val(),t=$(this.pageSelector+" input[name=orderCreatorName]").val(),i=""!=n?"P | "+n+" | "+t:"Nový produkt";super.setTitle(i)}}log(n,t){if(console.log(t),("object"==typeof t||Array.isArray(t))&&null!==t)for(var i in t)0==t[i]&&delete t[i];abp.auth.isGranted("Admin.Products.Edit")&&console.info(n+": ",t)}getGrammageRange(){var t,i=$(this.pageSelector+" .grammage-range").attr("data"),n=null==i||void 0===i?[]:i.split(",").join(".").split(";");return t=2==n.length?[parseFloat(n[0]),parseFloat(n[1])]:4==n.length?[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])]:[Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE],console.log(t),t}createStudio(n){var t;$(this.pageSelector+" #open-studio").append(' <i class="fa fa-spinner fa-spin"><\/i>');"function"==typeof smartsupp&&(null===(t=top.document.getElementById("smartsupp-widget-container"))||void 0===t||t.style.setProperty("display","none","important"));window.APP_DATA=n;$.when($.getScript(io.runtime),$.getScript(io.polyfills),$.getScript(io.main),$.Deferred(function(n){$(n.resolve)})).done(()=>{console.log("studio created"),$(this.pageSelector+" #open-studio i").remove()})}}class ut{constructor(n){this.canvases=[];this.mainColor="#bbb";this.Layout=n}drawLayout(){}setLayoutOnCanvas(){this.drawLayout()}destroy(){this.resizeIsEnabled&&window.removeEventListener("resize",this.resizeHandler,!1);null!=this.canvases&&(this.canvases=null)}}class ft extends ut{constructor(n,t){let i=[];i.push({container:document.getElementById("layout-full")});"RollMaterial"!=t&&i.push({container:document.getElementById("layout-last")});super(n);this.containers=i;this.Layout=n;this.parentKey=t;this.setLayoutOnCanvas()}getRollWidth(n,t){for(var u,r=0,i=(t=t||1,0);i<n.length;i++)u=n[i].left+n[i].width,u>r&&(r=u);return r*t}drawLayout(n=0){let t=this.containers[n].container;if(t.innerHTML="",t.style.background="white",t.style.border="1px solid "+this.mainColor,this.Layout.canvas&&this.Layout.canvas[n]){let f=this.Layout.canvas[n].boxes,e=this.clientWidth,o=this.clientHeight,i="RollMaterial"===this.parentKey?o/this.Layout.plateWidth:e/this.Layout.plateWidth,r=f.length,u=0,s=abp.setting.get("HtmlCanvasMaxWidth"),h=abp.setting.get("HtmlCanvasMaxHeight");for(let n=0;n<r;n++){let o=f[n],v=Math.floor(o.left*i),y=Math.floor(o.top*i),l=Math.floor(o.width*i),a=Math.floor(o.height*i);if(v+l>s-52||y+a>h-52){u++;continue}let p="white",c="";("SheetMaterial"===this.parentKey&&r<=0||"PlateMaterial"===this.parentKey&&!(n+2<r))&&(p="#f5f5f5",c=abp.localization.localize("NoPay","PrintDigital"));(l<60||a<60)&&(c="");let e=document.createElement("div");if(e.className="box",e.style.left=v+2+"px",e.style.top=y+2+"px",e.style.width=l-4+"px",e.style.height=a-4+"px",e.style.background=p,e.style.border="1px solid "+this.mainColor,e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",""!==c){let n=document.createElement("div");n.className="box-text";n.textContent=c;e.appendChild(n)}t.appendChild(e)}if(u>0){let n=document.createElement("div");n.textContent="... + "+u;n.style.position="absolute";n.style.left=e-50+"px";n.style.top=o/2-5+"px";n.style.fontSize="12px";n.style.fontFamily="Roboto Condensed";n.style.color="#000";t.appendChild(n)}}}setLayoutOnCanvas(){this.countW=this.Layout.widthCount;this.countH=this.Layout.heightCount;this.isFlipped=this.Layout.isFlipped;$("#doc-count").html(this.Layout.docCount.toString());$("#area-print-total").html(this.Layout.docAreaTotal.toString());$("#used-area-total").html(this.Layout.usedAreaTotal.toString());var e="Infinity"!=this.Layout.optimalUsagePercentage.toString()?this.Layout.optimalUsagePercentage.toString():"0.0";if($("#used-percentage").html(e),$("#plate-width").html(this.Layout.plateWidth.toString()),$("#plate-height").html(this.Layout.plateHeight.toString()),0==this.Layout.canvas.length)return this.containers[0].container.innerHTML="","RollMaterial"!=this.parentKey&&(this.containers[1].container.innerHTML=""),void $("#unfit-message").show();$("#unfit-message").hide();let n,i=document.querySelector(".ldp-layout-area").clientWidth,t=150,r=t/this.Layout.plateWidth;"RollMaterial"===this.parentKey?(n=this.getRollWidth(this.Layout.canvas[0].boxes,r),n>i&&(t-=17,r=t/this.Layout.plateWidth,n=this.getRollWidth(this.Layout.canvas[0].boxes,r))):(n=Math.floor(t*this.Layout.plateWidth/this.Layout.plateHeight),n>i&&(t=Math.floor(i/n*t),n=i));let f=Number(abp.setting.get("HtmlCanvasMaxWidth")),u=Number(abp.setting.get("HtmlCanvasMaxHeight"));this.clientWidth=Math.floor(n)>f?f:Math.floor(n);this.clientHeight=Math.floor(t)>u?u:Math.floor(t);console.log(i,u);console.log(this.clientWidth,this.clientHeight);this.containers.forEach((n,t)=>{n.container.style.width=this.clientWidth+2+"px",n.container.style.height=this.clientHeight+2+"px",this.drawLayout(t)});"SheetMaterial"===this.parentKey&&this.Layout.canvas[0].boxes.length<=2||"PlateMaterial"===this.parentKey&&2==this.Layout.canvas[0].boxes.length?(document.getElementById("layout-tabs")&&$("#layout-tabs").hide(),$('#layout-tabs a[href="#layout-last-tab"]').tab("show")):document.getElementById("layout-tabs")&&$("#layout-tabs").show()}}var f,r,e,o,s,u,h,c,d,l,a,v,y,g,p,w,b;!function(n){n[n.Null=0]="Null";n[n.Chroma0=1]="Chroma0";n[n.Chroma1=2]="Chroma1";n[n.Chroma2=3]="Chroma2";n[n.Chroma3=4]="Chroma3";n[n.Chroma4=5]="Chroma4";n[n.CMYK4=6]="CMYK4";n[n.CMYK6LcLm=7]="CMYK6LcLm";n[n.CMYK6LcLm200=8]="CMYK6LcLm200";n[n.NoColor=9]="NoColor";n[n.Chroma5=10]="Chroma5";n[n.Chroma6=11]="Chroma6";n[n.Chroma7=12]="Chroma7";n[n.Chroma8=13]="Chroma8"}(f||(f={})),function(n){n[n.Null=0]="Null";n[n.NoWhite=1]="NoWhite";n[n.W100=2]="W100";n[n.W200=3]="W200";n[n.W300=4]="W300"}(r||(r={})),function(n){n[n.Null=0]="Null";n[n.NoLacker=1]="NoLacker";n[n.L100Matte=2]="L100Matte";n[n.L200Matte=3]="L200Matte";n[n.L300Matte=4]="L300Matte"}(e||(e={})),function(n){n[n.Null=0]="Null";n[n.NoLacker=1]="NoLacker";n[n.YesLacker=2]="YesLacker"}(o||(o={})),function(n){n[n.Null=0]="Null";n[n.NoUvRed=1]="NoUvRed";n[n.YesUvRed=2]="YesUvRed"}(s||(s={})),function(n){n[n.Null=0]="Null";n[n.NoLamino=1]="NoLamino";n[n.Matte=2]="Matte";n[n.Glossy=3]="Glossy"}(u||(u={})),function(n){n[n.Null=0]="Null";n[n.NoLacker=1]="NoLacker";n[n.L100Glossy=2]="L100Glossy";n[n.L200Glossy=3]="L200Glossy";n[n.L100Matte=4]="L100Matte";n[n.L200Matte=5]="L200Matte"}(h||(h={})),function(n){n[n.Null=0]="Null";n[n.NoPerson=1]="NoPerson";n[n.Numbering=2]="Numbering";n[n.DynamicText=3]="DynamicText";n[n.DynamicTextAndPictures=4]="DynamicTextAndPictures"}(c||(c={})),function(n){n[n.Null=0]="Null";n[n.Silver10=1]="Silver10";n[n.Silver11=2]="Silver11"}(d||(d={})),function(n){n[n.Null=0]="Null";n[n.NoColor=1]="NoColor";n[n.White=2]="White";n[n.Bronze=3]="Bronze";n[n.Red=4]="Red";n[n.Black=5]="Black";n[n.Transparent=6]="Transparent";n[n.Brown=7]="Brown";n[n.Cream=8]="Cream";n[n.Matte=9]="Matte";n[n.Blue=10]="Blue";n[n.Ocherous=11]="Ocherous";n[n.Gray=12]="Gray";n[n.Silver=13]="Silver";n[n.LightBlue=14]="LightBlue";n[n.DarkRed=15]="DarkRed";n[n.Green=16]="Green";n[n.Yellow=17]="Yellow";n[n.Aluminium=18]="Aluminium";n[n.Grafit=19]="Grafit";n[n.Various=20]="Various"}(l||(l={})),function(n){n[n.Null=0]="Null";n[n.Init=1]="Init";n[n.Setup=2]="Setup";n[n.Rip=3]="Rip";n[n.Print=4]="Print";n[n.Postprocess=5]="Postprocess";n[n.Finished=6]="Finished"}(a||(a={})),function(n){n[n.Null=0]="Null";n[n.PersonalCollection=1]="PersonalCollection";n[n.CourierSK=5]="CourierSK";n[n.CourierBA=6]="CourierBA"}(v||(v={})),function(n){n[n.Null=0]="Null";n[n.PayOnPlace=1]="PayOnPlace";n[n.CashOnDelivery=2]="CashOnDelivery";n[n.BankTransfer=3]="BankTransfer";n[n.GoPay_Card=11]="GoPay_Card";n[n.GoPay_Sporopay=12]="GoPay_Sporopay";n[n.GoPay_TatraPay=13]="GoPay_TatraPay";n[n.GoPay_VubPay=14]="GoPay_VubPay";n[n.GoPay_PayPal=15]="GoPay_PayPal"}(y||(y={})),function(n){n[n.Null=0]="Null";n[n.NoEdgePrint=1]="NoEdgePrint";n[n.EdgePrint=2]="EdgePrint"}(g||(g={})),function(n){n[n.Null=0]="Null";n[n.NoScrews=1]="NoScrews";n[n.YesScrews4Silver=2]="YesScrews4Silver"}(p||(p={})),function(n){n[n.HaveData=0]="HaveData";n[n.UseGraphic=1]="UseGraphic";n[n.OnlineStudio=2]="OnlineStudio"}(w||(w={})),function(n){n[n.Null=0]="Null";n[n.NoFrame=1]="NoFrame";n[n.Black=2]="Black";n[n.White=3]="White";n[n.Cream=4]="Cream";n[n.BrownWood=5]="BrownWood";n[n.WhiteWood=6]="WhiteWood";n[n.GreyWood=7]="GreyWood";n[n.BlackWood=8]="BlackWood";n[n.NaturalWood=9]="NaturalWood"}(b||(b={}));class t{static getEnumsByname(n){return t[n]}}t.ChromaEnum=f;t.WhiteEnum=r;t.LackerMatteSdpEnum=e;t.LackerGlossSdpEnum=o;t.UvRedEnum=s;t.LaminoEnum=u;t.LackerLdpEnum=h;t.PersonalizationEnum=c;t.ColorEnum=l;t.ProductStateEnum=a;t.ShippingTypeEnum=v;t.PaymentTypeEnum=y;t.ScrewsEnum=p;t.PrintDataTypeEnum=w;t.FramEnum=b;class et extends rt{constructor(n){super("LargeDigitalPrint",n)}onStart(){this.onEnter();var n=JSON.parse(this.P$("input[name=start-layout]").val());this.P$("input[name=start-layout]").remove();this.updateProductData();this.LayoutManager=new ft(n,this.Product.parentKey);this.toggleDraftPrice();this.initModals();this.initItemCountBounderies();this.initDimensionRestrictions();super.onStart()}onDestroy(){this.P$("#grid-container").cubeportfolio("destroy");$(this.pageSelector+" #material-gallery").remove();$("body").off("click",".material-item");$(this.pageSelector+" .collapse-other-options-ldp").off("click");$(this.pageSelector+" .copy-product").off("click");$(this.pageSelector+" #open-studio").off("click");$(this.pageSelector+" .close-studio").off("click");super.onDestroy();this.LayoutManager.destroy()}updateProductData(){this.P$('input[name="itemCount"]').val()<1&&this.P$('input[name="itemCount"]').val(1);this.Product.encapsulationOrBleed=!1;this.Product.noBindOrDuplex=!1;this.Product.dieCut=!1;this.Product.kissCut=!1;this.Product.roundedCorners=!1;this.Product.edgeReinforcement=!1;this.Product.eyelets=!1;this.Product.tunnel=!1;super.updateProductData();this.Product.encapsulationOrBleed=!$(this.pageSelector+" #encapsulationOrBleedLdp").is(":checked")}initFormEvents(){super.initFormEvents();var n=!1;$(this.pageSelector+" .collapse-other-options-ldp").on("click",t=>{var i,r,f;if(t.preventDefault(),n){for($(this.pageSelector+" .my-caret").css("transform","rotate(0deg)"),i=0,r=$(this.pageSelector+" .other-option-checkbox:checked"),r.prop("checked",!1),i=0;i<r.length;i++)f=$(r[i]),this.checkInputBeforeCalculatePrice(f);r.length>0&&this.calculatePrice();$("#collapseOtherOptionsLdp").toggle("collapse");$(".help-panel-other-options").hide()}else if($(this.pageSelector+" .my-caret").css("transform","rotate(180deg)"),$("#collapseOtherOptionsLdp").toggle("collapse"),$(".help-panel-other-options").length){$(".help-panel-other-options").show();$(".help-panel-other-options").offset();var e=$("#collapseOtherOptionsLdp").offset(),o=$(".backstage.large").offset(),u=e.top-(o.top+$(".backstage.large").outerHeight());u=u<0?0:u;$(".help-panel-other-options").css("margin-top",u.toString()+"px");$(".help-panel-other-options-title").css("color","black");$(".help-panel-other-options-title").text("Špeciálne nastavenia");$(".help-panel-other-options-desc").text("Po výbere špeciálneho nastavenia sa zobrazí pomôcka pre správne vyplnenie formuláru.");$(".special-options-image").attr("src","/Content/images/products/"+abp.localization.localize("SpecialOptions","PrintDigital")+".jpg");super.changeHeightOfBackstage()}n=!n});$(this.pageSelector+" .copy-product").on("click",()=>{var t;this.updateProductData();var i=abp.localization.localize(["ColorPrint","ColorPrint200","NoColor"][this.Product.chromaFrontEnum-7],"PrintDigital"),f=Number($(this.pageSelector+' select[name="laminoFrontEnum"]').selectpicker("val")),n=abp.localization.localize(this.Product.productTemplateId,"PrintDigital")+"\n\nNáklad: "+this.Product.itemCount+"ks\nFormát: "+this.Product.width+" x "+this.Product.height+" mm",e=$(this.pageSelector+' select[name="laminoFrontEnum"]').siblings("button.dropdown-toggle").attr("title"),o="";"RollMaterial"!=this.Product.parentKey&&(o=" "+this.Product.grammageOrThickness+("PlateMaterial"===this.Product.parentKey?"mm":"g"));n+="\nMateriál: "+$(this.pageSelector+" select[name=materialSel]").find("option:selected").text()+o+"\nFarebnosť: "+i+(this.Product.noBindOrDuplex?" + "+i:"")+(this.Product.dieCut?"\nOrez: Áno":"")+("RollMaterial"===this.Product.parentKey?this.Product.kissCut?"\nPredrez: Áno":"":this.Product.kissCut?"\nTvarový výrez: Áno":"")+(void 0===e||f==u.NoLamino||f==u.Null?"":"\nLamino: "+e)+(this.Product.encapsulationOrBleed?"\nSpadavka: Áno":"")+(this.Product.whiteLdpEnum!=r.NoWhite&&this.Product.whiteLdpEnum!=r.Null?"\nTlač bielou: "+abp.localization.localize(["No","100%","200%","300%"][this.Product.whiteLdpEnum-1],"PrintDigital"):"")+(this.Product.edgeReinforcement?"\nSpevnenie okrajov: Áno":"")+(this.Product.eyelets?"\nOčká: Áno":"")+(this.Product.tunnel?"\nTunel: Áno":"");t=$(this.pageSelector+" textarea[name=extraWork]").val();n+=null!=t&&""!=t?"\n\nPoznámka Typoconu: "+t:"";n+="\n\nCena: "+$(this.pageSelector+" #price-base").text()+"€\nCena po zľave: "+$(this.pageSelector+" #price-discount").text()+"€\nCena za kus: "+$(this.pageSelector+" #price-item").text()+"€\nSpolu s DPH: "+$(this.pageSelector+" #price-total").text()+"€";super.copyToClipboard(n);console.log("vypis copy",n);abp.notify.info(app.localize("ProductCopiedToClipboard"))});$(this.pageSelector+" #open-studio").on("click",()=>{this.updateProductData();var n=$(this.pageSelector+" input[name=directory]").val();"/"!=n.slice(-1)&&(n="/Uploads/LocalUser/"+n+"/");this.createStudio({pageLimit:Number(this.Product.itemCount),pageWidth:Number(this.Product.width),pageHeight:Number(this.Product.height),directory:n,mask:this.Product.productTemplateId,templateName:this.Product.productTemplateId,productId:this.Product.defaultProductId})})}getGrammagesForMaterial(n,t){var i=$(this.pageSelector+" select[name=grammageOrThickness]");abp.services.app.material.getMaterialSpecification(n).then(r=>{i.empty();var u=super.getGrammageRange();$.each(r.grammages,function(t,r){(r>=u[0]&&r<=u[1]||"NoMaterial"==n)&&i.append($("<option><\/option>").attr("value",r).text(r))});null!=t&&i.val(t);this.P$("#material-image").attr("src","/Content/images/materials/"+r.imageName);this.P$("#material-name").html(r.name);this.P$("#material-desc").html(r.description);super.changeHeightOfBackstage();this.calculatePrice()})}afterCalculatePriceHandler(n){var r,i,t,u;(this.log("price",n),0==n.layout.canvas.length||void 0===n.priceBase)?(this.P$("#price-base").html("0,00"),this.P$("#price-discount").html("0,00"),this.P$("#price-item").html("0,00"),this.P$("#price-total").html("0,00"),this.P$("#add-to-basket").prop("disabled",!0)):(void 0===n.chromaPrice&&(n.chromaPrice=0),void 0===n.priceBase&&(n.priceBase=0),void 0===n.priceWithTax&&(n.priceWithTax=0),i=Number(abp.setting.get("LdpMinPrice")),t=n.priceBase-.01*this.Product.discount*n.chromaPrice,t=t<0?0:t,i>0&&Number(n.priceDiscount)<=i&&(t=i),u=0==this.Product.itemCount||0==t?t:t/this.Product.itemCount,this.P$("#price-base").html(NumberFormatter.formatDecimal(n.priceBase,2)),this.P$("#price-discount").html(NumberFormatter.formatDecimal(t,2)),this.P$("#price-item").html(NumberFormatter.formatDecimal(u,2)),this.P$("#price-total").html(NumberFormatter.formatDecimal(n.priceWithTax,2)),this.P$("#price-manipulation").html(NumberFormatter.formatDecimal(n.manipulationPrice,2)),this.P$("#add-to-basket").prop("disabled",!1));Object.keys(n).forEach(function(t){n[t]});this.LayoutManager.Layout=n.layout;console.log(this.LayoutManager.Layout);this.LayoutManager.setLayoutOnCanvas();null!==(r=n.weight)&&void 0!==r||(n.weight=0);$(this.pageSelector+" #product-weight").html(NumberFormatter.formatDecimal(n.weight,2));$(this.pageSelector+" input[name=weight]").val(n.weight);this.toggleDraftPrice();this.turnOnEdgeReinforcement()}checkInputBeforeCalculatePrice(n){var u=!0,t=n.attr("name"),r,o,s,y,h,p,w;if(null==t&&(u=!1),r=null,"itemCount"===t?r=this.Product.itemCount:"width"===t?r=this.Product.width:"height"===t&&(r=this.Product.height),null!=r&&(isNaN(n.val())||n.val()%1!=0)&&(n.val(r),u=!1),"itemCount"===t&&(n.val()<this.min&&n.val(this.min),n.val()>this.max&&n.val(this.max)),"width"===t||"height"===t){var i,c=Math.min(this.minDimensions[0],this.minDimensions[1]),e=Math.max(this.minDimensions[0],this.minDimensions[1]),f=Math.min(this.maxDimensions[0],this.maxDimensions[1]),l=Math.max(this.maxDimensions[0],this.maxDimensions[1]),a=this.P$("input[name=height]"),v=this.P$("input[name=width]");"width"===t?i=a:"height"===t&&(i=v);$(n).val()>l?($(n).val(l),i.val()>f&&i.val(f)):$(n).val()>f&&i.val()>f&&i.val(f);$(n).val()<e&&($(n).val()<c&&$(n).val(c),i.val()<e&&i.val(e));this.P$('select[name="formatKey"]').selectpicker("val","Custom");$(this.pageSelector+" .format-label").html(" "+v.val()+"x"+a.val()+" mm")}else"formatKey"==t?(o=this.P$('select[name="formatKey"]').selectpicker("val"),"Custom"!==o&&(s=this.ActualFormats.getFormatByValue(o),this.P$("input[name=width]").val(s.width),this.P$("input[name=height]").val(s.height))):"materialSel"===t?(y=this.P$('select[name="materialSel"]').selectpicker("val"),this.getLdpMaterials(y.split("@")[0]),u=!1):"grammageOrThickness"===t?(h=this.P$("select[name=materialKey]"),h.val(this.P$("select[name=materialKey] option:first").val()),p=h.val(),w=Number($(n).val()),this.getLdpMaterials(p,w),u=!1):"isWhite"==t?n.is(":checked")||($(this.pageSelector+" select[name=whiteLdpEnum]").selectpicker("val","1"),$(this.pageSelector+" .c-white-ldp").hide(120)):"isLamino"==t?n.is(":checked")||($(this.pageSelector+" select[name=laminoFrontEnum]").selectpicker("val","1"),$(this.pageSelector+" .c-lamino-ldp").hide(120)):"isScrews"==t&&(n.is(":checked")||($(this.pageSelector+" select[name=screws]").selectpicker("val","1"),$(this.pageSelector+" .c-screws-ldp").hide(120)));return u}toggleDraftPrice(){if(this.canShowDraftPrice()){var n=this.Product.kissCut;this.Product.width;this.Product.height;n?(n?this.P$(".draft-kiss-cut").show():this.P$(".draft-kiss-cut").hide(),this.P$(".draft-small-format").hide(),this.P$(".c-price-draft-after-agreed").hide(),this.P$(".c-price-draft").show(),this.P$("#add-to-basket").html(abp.localization.localize("SetCalculation","PrintDigital")).removeClass("c-btn-blue").addClass("c-btn-purple"),this.Product.isPriceDraft=!0):(this.P$(".c-price-draft-after-agreed").hide(),this.P$(".c-price-draft").hide(),this.P$("#add-to-basket").html(abp.localization.localize("AddToShoppingCart","PrintDigital")).removeClass("c-btn-purple").addClass("c-btn-blue"),this.Product.isPriceDraft=!1)}}getLdpMaterials(n,t){abp.services.app.material.getLdpMaterial(n,t).then(i=>{var r=i.materials[0],e,u,f;$.each(i.materials,function(n,t){if(1==t.isActive)return r=t,!1});e="/Content/images/LargeDigitalPrint/Materials/"+i.imageFile;this.P$("#material-name").html(r.name);this.P$("#material-desc").html(r.description);this.P$("#material-image").attr("src",e);r.isOnOrder?this.P$(".isOnOrder").show():this.P$(".isOnOrder").hide();super.changeHeightOfBackstage();this.P$("#material-image").parent().attr("href",e);this.P$("#material-image").parent().attr("data-title",r.name+"<br>"+r.description);var o=this.P$("select[name=grammageOrThickness]").empty(),h=this.getMaterialGrammagesOrThickensses(i.materials),s=super.getGrammageRange();console.log("GoT",h);console.log("range",s);$.each(h,function(t,i){(i>=s[0]&&i<=s[1]||"NoMaterial"==n)&&(o.append('<option value="'+i.toString().replace(",",".")+'">'+i+"<\/option>"),console.log("tento presiel:",i))});u=null!=t?t:r.defaultGrammageOrThickness;o.val(u.toString().replace(",","."));o.selectpicker("refresh");f=this.P$("select[name=materialKey]").empty();f.append('<option value="'+i.id+'" selected>optimum<\/option>');$.each(i.materials,(n,t)=>{if((t.isActive||t.Id==this.Product.materialKey)&&null!=u&&(t.useGrammage&&-1!=t.grammages.indexOf(u)||!t.useGrammage&&-1!=t.thicknesses.indexOf(u))){var r=t.isActive?"":"disabled",i='<option value="'+t.id+'" '+r+" >"+t.width+"mm";"RollMaterial"!=this.Product.parentKey&&(i+=" x "+t.height+"mm<\/option>");f.append(i)}});f.selectpicker("refresh");this.calculatePrice()})}initModals(){this.isMaterialPortfolioInit=!1;this.isFramePortfolioInit=!1;this.initMaterialModal();this.initFrameModal()}initMaterialModal(){this.P$("#grid-container").cubeportfolio({filters:"#filters-container",layoutMode:"grid",mediaQueries:[{width:1100,cols:2},{width:800,cols:2},{width:500,cols:1},{width:320,cols:1}],defaultFilter:"*",animationType:"rotateSides",gapHorizontal:10,gapVertical:10,gridAdjustment:"responsive",caption:"",displayType:"default",displayTypeSpeed:100});this.P$("#material-gallery").on("shown.bs.modal",()=>{$(window).trigger("resize.cbp")});$("body").on("click",".material-item",n=>{var t,i;n.preventDefault();t=$(n.currentTarget).attr("data-id");this.P$("#material-gallery").modal("hide");$(".cbp-popup-close").click();i=$(this.pageSelector+" select[name=materialSel] option[value^='"+t+"']").val();$(this.pageSelector+" select[name=materialSel]").val(i);$(this.pageSelector+" select[name=materialSel]").selectpicker("refresh");this.getLdpMaterials(t)})}initFrameModal(){$(this.pageSelector+" #frame-gallery").on("shown.bs.modal",()=>{this.isFramePortfolioInit?$(window).trigger("resize.cbp"):($(this.pageSelector+" #grid-container-4").cubeportfolio({layoutMode:"grid",mediaQueries:[{width:1100,cols:3},{width:800,cols:2},{width:500,cols:2},{width:320,cols:1}],animationType:"none",gapHorizontal:10,gapVertical:10,gridAdjustment:"responsive",caption:"",displayType:"default",displayTypeSpeed:100}),this.isFramePortfolioInit=!0)});$(this.pageSelector+" .frame-item").on("click",n=>{n.preventDefault();var t=$(n.currentTarget).attr("data-id"),i=$(n.currentTarget).attr("data-frame-code");$("#frame-gallery").modal("hide");$(this.pageSelector+" .frame-img").attr("src","/Content/images/LargeDigitalPrint/Frames/"+t+".jpg");$(this.pageSelector+" .frameEye").html(abp.localization.localize(t+"Frame","PrintDigital"));$(this.pageSelector+" .frame-code").html(i);$(this.pageSelector+" input[name=frameEnum]").val(t);this.calculatePrice()})}getMaterialGrammagesOrThickensses(n){for(var t,u,i=[],r=0;r<n.length;r++)t=n[r],t.isActive&&(u=t.useGrammage?t.grammages:t.thicknesses,i=i.concat(u));return this.arrayUnique(i)}arrayUnique(n){for(var r,t=n.concat(),i=0;i<t.length;++i)for(r=i+1;r<t.length;++r)t[i]===t[r]&&t.splice(r--,1);return t.sort(function(n,t){return n-t})}turnOnEdgeReinforcement(){var i,n,r,t;("RollBanner"==this.Product.productTemplateId||"RollMesh"==this.Product.productTemplateId)&&(i=Number(abp.setting.get("LdpBleedMm")),n=(Number(abp.setting.get("LdpEdgeReinforcementMm")),Math.min(this.P$("input[name=width]").val(),this.P$("input[name=height]").val())),n+=$('input[name="encapsulationOrBleed"]').is(":checked")?2*i:0,r=$('select[name="materialKey"] option'),t=$.map(r,function(n){if(n.value.includes("@")&&n.value.includes("x"))return Number(n.value.split("@").pop().split("x")[0])}),(0==t.length?3200:Math.max(...t))<n?($(this.pageSelector+" input[name=edgeReinforcement]").prop("checked",!0).prop("disabled",!0),$(".must-have-edge").show()):($(this.pageSelector+" input[name=edgeReinforcement]").prop("disabled",!1),$(".must-have-edge").hide()))}}const k=jQuery;k(document).ready(function(){k('[data-toggle="popover"]').popover();k(".tooltips").tooltip();new et("#largeDigitalPrint-form").onStart()})})();
