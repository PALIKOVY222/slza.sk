var Reviews=function(){var n=0,t=0,o=$("<img>").attr("src","/Content/images/typocon_avatar.png").css({width:"100%"}),s=null,r=function(n,t){var i,u,c,l,p,a,f,v,e,y,s,w;if(console.log(n),i=$("#review-item-template").clone(),u=i.find(".review-avatar-name"),u.attr("data-name",n.avatarName),n.name=="Typocon"?u.css({"line-height":"1 !important"}).append(o.clone()):(u.text(n.avatarName),c=h(n.avatarName,80,75),u.css({background:c}),i.find(".review-date").text(n.date),l=i.find(".review-date"),i.find(".review-name").text(n.name),i.find(".review-name").append(l)),i.find(".create-review-response-button").attr("data",n.id),(n.positives==""||n.positives==null)&&(n.negatives==""||n.negatives==null)?i.find(".review-positives-negatives").remove():(p=$("<i/>").addClass("fa fa-minus-circle")[0],a=i.find(".review-positives"),n.positives!=null&&n.positives!=""&&(f=n.positives.split("\n"),$.each(f,function(n){if(f[n]!=null&&f[n]!=""){var t=$("<li/>").text(f[n]).appendTo(a);t.prepend(" ").prepend($("<i/>").addClass("fa fa-plus c-font-green "))}})),v=i.find(".review-negatives"),n.negatives!=null&&n.negatives!=""&&(e=n.negatives.split("\n"),$.each(e,function(n){if(e[n]!=null&&e[n]!=""){var t=$("<li/>").text(e[n]).appendTo(v);t.prepend(" ").prepend($("<i/>").addClass("fa fa-minus c-font-red "))}}))),n.text==null||n.text==""?i.find(".review-main-text").css({"font-style":"italic"}).text(abp.localization.localize("NoTextInReview","PrintDigital")):i.find(".review-main-text").text(n.text),y=i.find(".review-response"),n.childReviews!=null)for(s=0;s<n.childReviews.length;s++)w=r(n.childReviews[s],y);n.name=="Typocon"&&i.find(".panel").css({"background-color":"whitesmoke"});i.show();t.append(i);n.rating!=null&&n.rating>0?t.children().last().find(".rateYo").rateYo({rating:n.rating,starWidth:"20px",readOnly:!0}):t.children().last().find(".rateYo").remove()},u=function(){var u=$("#itemInReviewId").val(),i=$(".all-reviews-count").attr("data");i>0?abp.services.app.reviews.getReviewsList(u,n).then(function(u){for(var e,s,o=$(".reviews-container"),f=0;f<u.length;f++)e=u[f],s=r(e,o);n++;t+=u.length;u.length<5||i==t.toString()?$(".load-more-reviews").hide():$(".load-more-reviews").show()}):$(".load-more-reviews").hide()},h=function(n,t,i){for(var f,r=0,u=0;u<n.length;u++)r=n.charCodeAt(u)*83+((r<<5)-r);return f=r%360,"hsl("+f+", "+t+"%, "+i+"%)"},c=function(){u();$(".load-more-reviews").on("click",function(){$(".load-more-reviews").hide();u()})},f=0,a=function(){for(i=0;i<5;i++)$(".review-row-"+f.toString()).show(),f++},e=function(){var t=$("#review-form"),n=s||t.serializeFormToObject();(n.rating=$("#review-form-rating").rateYo("rating"),isNaN(n.itemInReviewId)?n.productTemplateId=n.itemInReviewId:n.articleId=parseInt(n.itemInReviewId),delete n.itemInReviewId,n.name==null||n.name==""||n.email==null||n.email==""||n.email.indexOf("@")<0)||abp.ui.setBusy(t,abp.services.app.reviews.createReview(n).then(function(){$("#create-review-modal").modal("hide");$("#review-form")[0].reset();toastr.info(abp.localization.localize("ThankAndWaitForApproval","PrintDigital"));grecaptcha.reset()}))},l=()=>{var t=$("#review-form"),n;t.validate({rules:{name:"required",email:"required"},highlight:function(n){$(n).closest(".form-group").addClass("has-error")},unhighlight:function(n){$(n).closest(".form-group").removeClass("has-error")},errorElement:"span",errorPlacement:function(){}});t.on("submit",n=>{(n.preventDefault(),t.valid())&&e(null)});$("#create-review-response-modal").on("shown.bs.modal",function(n){$("#parentReviewId").val($(n.relatedTarget).attr("data"))});n=$("#review-response-form");n.on("submit",function(t){t.preventDefault();console.log(t);var i=n.serializeFormToObject();isNaN(i.itemInReviewResponseId)?i.productTemplateId=i.itemInReviewResponseId:i.articleId=parseInt(i.itemInReviewResponseId);delete i.itemInReviewResponseId;abp.ui.setBusy(n,abp.services.app.reviews.createReview(i).then(function(){$("#create-review-response-modal").modal("hide");$("#review-response-form")[0].reset();toastr.info(abp.localization.localize("AnswerSaved","PrintDigital"))}))})};return{init:function(){c();l()},onCreateReview:function(n){e(n)}}}();
